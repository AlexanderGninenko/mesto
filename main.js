(()=>{"use strict";class e{constructor(e,t){this._config=e,this._form=t,this._inputList=Array.from(this._form.querySelectorAll(this._config.inputSelector)),this._button=this._form.querySelector(this._config.submitButtonSelector)}_showInputError(e,t){const s=this._form.querySelector(`.${e.id}-error`);e.classList.add(this._config.inputErrorClassActive),s.textContent=t,s.classList.add(this._config.errorClass)}_hideInputError(e){const t=this._form.querySelector(`.${e.id}-error`);t.classList.remove(this._config.errorClass),e.classList.remove(this._config.inputErrorClassActive),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hasInvalidInput(e){return e.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput(this._inputList)?this.disableSubmitButton():this.enableSubmitButton()}_setEventListeners(){this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}resetValidation(){this._inputList.forEach((e=>{this._hideInputError(e)}))}enableSubmitButton(){this._button.classList.remove(this._config.inactiveButtonClass),this._button.disabled=!1}disableSubmitButton(){this._button.classList.add(this._config.inactiveButtonClass),this._button.disabled=!0}enableValidation(){this._setEventListeners()}}class t{constructor(e,t,s,{data:r,handleCardClick:i,handleLikeClick:n,handleConfirmDelete:o}){this._name=r.name,this._link=r.link,this._likes=r.likes,this._cardSelector=e,this._handleCardClick=i,this._handleLikeClick=n,this._handleConfirmDelete=o,this._api=t,this._id=r._id,this._ownerId=r.owner._id,this._userId=s}_getCardTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}generateCard(){return this._card=this._getCardTemplate(),this._cardImage=this._card.querySelector(".card__image"),this._setEventListeners(),this._cardImage.src=this._link,this._cardImage.alt=this._name,this._card.querySelector(".card__title").textContent=this._name,this._card.querySelector(".card__like-count").textContent=this._likes.length,this._ownerId!==this._userId&&(this._card.querySelector(".card__delete-btn").style.display="none"),this._likes.find((e=>this._userId===e._id))&&this._card.querySelector(".card__like-btn").classList.add("card__like-btn_active"),this._card}_setEventListeners(){this._card.querySelector(".card__like-btn").addEventListener("click",(()=>this._handleLikeClick())),this._card.querySelector(".card__delete-btn").addEventListener("click",(()=>this._handleConfirmDelete())),this._card.querySelector(".card__image").addEventListener("click",(()=>{this._handleCardClick({name:this._name,src:this._link})}))}handleLikeCard(){const e=this._card.querySelector(".card__like-btn"),t=this._card.querySelector(".card__like-count");e.classList.contains("card__like-btn_active")?this._api.dislike(this._id).then((s=>{e.classList.remove("card__like-btn_active"),t.textContent=s.likes.length})).catch((e=>{console.log(e)})):this._api.like(this._id).then((s=>{e.classList.add("card__like-btn_active"),t.textContent=s.likes.length})).catch((e=>{console.log(e)}))}handleDeleteCard(){this._card.closest(".card").remove()}}class s{constructor(e){this._popupSelector=document.querySelector(e),this._handleOverlayClose=this._handleOverlayClose.bind(this),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popupSelector.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupSelector.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}_handleOverlayClose(e){(e.target.classList.contains("popup__close-icon")||e.target===e.currentTarget)&&this.close()}setEventListeners(){this._popupSelector.querySelector(".popup__close-icon").addEventListener("click",(()=>this.close())),this._popupSelector.addEventListener("mousedown",this._handleOverlayClose)}}class r extends s{constructor(e,t){super(e),this._submitForm=t,this._popupForm=this._popupSelector.querySelector(".popup__form"),this._inputList=this._popupForm.querySelectorAll(".popup__input"),this._popupButton=this._popupForm.querySelector(".popup__save-btn"),this._popupButtonTextContent=this._popupButton.textContent}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>this._formValues[e.name]=e.value)),this._formValues}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._submitForm(this._getInputValues())}))}close(){super.close(),this._popupForm.reset()}renderLoading(e){this._popupButton.textContent=e?"Сохранение...":this._popupButtonTextContent}}const i={formSelector:".popup__form",inputSelector:".popup__input",inputErrorClass:".popup__input-error",submitButtonSelector:".popup__save-btn",inactiveButtonClass:"popup__save-btn_disabled",inputErrorClassActive:"popup__input_type_error",errorClass:"popup__input-error_active"},n=document.forms.popupProfileForm,o=document.forms.popupPlaceForm,a=document.forms.popupAvatarEditForm,l=(document.querySelector(".popup__input_place_name"),document.querySelector(".popup__input_place_link"),document.querySelector(".popup__input_profile_name")),c=document.querySelector(".popup__input_profile_status"),h=document.querySelector(".profile__add-btn"),d=document.querySelector(".profile__edit-btn"),p=document.querySelector(".profile__avatar-edit-button"),_=new e(i,a);_.enableValidation();const u=new e(i,n);u.enableValidation();const m=new e(i,o);m.enableValidation();const f=new class{constructor(e){this._url=e.url,this._headers=e.headers}_checkResponse(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}getUserInfo(){return fetch(this._url+"/users/me",{method:"GET",headers:this._headers}).then(this._checkResponse)}getInitialCards(){return fetch(this._url+"/cards",{method:"GET",headers:this._headers}).then(this._checkResponse)}sendUserInfo(e){return fetch(this._url+"/users/me",{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.profileFormName,about:e.profileFormStatus})}).then(this._checkResponse)}addUserCard(e){return fetch(this._url+"/cards",{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})}).then(this._checkResponse)}like(e){return fetch(this._url+`/cards/likes/${e}`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}dislike(e){return fetch(this._url+`/cards/likes/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}delete(e){return fetch(this._url+`/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}handleUserAvatar(e){return fetch(this._url+"/users/me/avatar",{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e.userAvatar})}).then(this._checkResponse)}getAllNeededData(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}}({url:"https://mesto.nomoreparties.co/v1/cohort-42",headers:{authorization:"15b7f773-dbdf-4b9e-9380-ba8374828004","Content-Type":"application/json"}}),v=new class extends s{constructor(e){super(e),this._popupForm=this._popupSelector.querySelector(".popup__form"),this._popupButton=this._popupForm.querySelector(".popup__save-btn"),this._popupButtonTextContent=this._popupButton.textContent}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleDeleteCard()}))}setSubmitAction(e){this._handleDeleteCard=e}renderLoading(e){this._popupButton.textContent=e?"Сохранение...":this._popupButtonTextContent}}(".popup_confirm-delete");v.setEventListeners();const S=new class{constructor(e){this._profileName=document.querySelector(e.name),this._profileStatus=document.querySelector(e.about),this._profileAvatar=document.querySelector(e.avatar)}getUserInfo(){return this._userData={name:this._profileName.textContent,about:this._profileStatus.textContent},this._userData}setUserInfo(e){this._profileName.textContent=e.name,this._profileStatus.textContent=e.about,this.setUserAvatar(e)}setUserAvatar(e){this._profileAvatar.src=e.avatar}}({name:".profile__name",about:".profile__status",avatar:".profile__avatar"}),C=new class extends s{constructor(e){super(e),this._popupImage=this._popupSelector.querySelector(".popup__image"),this._popupDescription=this._popupSelector.querySelector(".popup__image-description")}open(e){super.open(),this._popupImage.src=e.link,this._popupImage.alt=e.name,this._popupDescription.textContent=e.name}}(".popup_image");C.setEventListeners();const g=new r(".popup_profile",(e=>{g.renderLoading(!0),f.sendUserInfo(e).then((e=>{S.setUserInfo(e),g.close()})).catch((e=>console.log(e))).finally((()=>g.renderLoading(!1)))}));g.setEventListeners();const b=new r(".popup_place",(e=>{b.renderLoading(!0),f.addUserCard(e).then((e=>{const t=L(e);y.addItem(t),m.disableSubmitButton(),b.close()})).catch((e=>console.log(e))).finally((()=>b.renderLoading(!1)))}));b.setEventListeners();const k=new r(".popup_avatar",(e=>{k.renderLoading(!0),f.handleUserAvatar(e).then((e=>{S.setUserAvatar(e),_.disableSubmitButton(),k.close()})).catch((e=>console.log(e))).finally((()=>k.renderLoading(!1)))}));k.setEventListeners();const L=e=>{const s=new t("#card-template",f,E,{data:e,handleCardClick:()=>{C.open(e)},handleLikeClick:()=>{s.handleLikeCard()},handleConfirmDelete:()=>{v.setSubmitAction((()=>{v.renderLoading(!0),f.delete(e._id).then((()=>{s.handleDeleteCard(),v.close()})).catch((e=>console.log(e))).finally((()=>v.renderLoading(!1)))})),v.open()}});return s.generateCard()},y=new class{constructor({renderer:e},t){this._renderer=e,this._container=document.querySelector(t)}renderItems(e){e.forEach((e=>this._renderer(e)))}addItem(e){this._container.prepend(e)}}({renderer:e=>{const t=L(e);y.addItem(t)}},".photo-grid__wrapper");let E;h.addEventListener("click",(()=>{m.resetValidation(),m.disableSubmitButton(),b.open()})),d.addEventListener("click",(()=>{const e=S.getUserInfo();l.value=e.name,c.value=e.about,u.resetValidation(),u.enableSubmitButton(),g.open()})),p.addEventListener("click",(()=>{_.resetValidation(),k.open()})),f.getAllNeededData().then((([e,t])=>{S.setUserInfo(t),E=t._id,y.renderItems(e)})).catch((e=>console.log(e)))})();